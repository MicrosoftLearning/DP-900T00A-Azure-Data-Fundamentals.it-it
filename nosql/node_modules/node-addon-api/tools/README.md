---
ms.openlocfilehash: 3decbdeed6f0c742925a5be9b78f5251a4c0b569
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051204"
---
# <a name="tools"></a>Strumenti

## <a name="clang-format"></a>clang-format

Gli strumenti di controllo clang-format sono progettati per controllare le righe di codice modificate rispetto ai riferimenti Git specificati.

## <a name="migration-script"></a>Script di migrazione

Lo strumento di migrazione è progettato per ridurre il lavoro ripetitivo nel processo di migrazione. Tuttavia, lo script non mira a convertire tutto. Sono in genere richieste alcune piccole correzioni e una ricostruzione importante.

### <a name="how-to-use"></a>Utilizzo

Per eseguire lo script di conversione, assicurarsi prima di tutto di avere la versione più recente di `node-addon-api` nella directory `node_modules`.
```
npm install node-addon-api
```

Eseguire quindi lo script passando la directory del progetto.
```
node ./node_modules/node-addon-api/tools/conversion.js ./
```

Al termine, ricompilare ed eseguire il debug degli elementi non convertiti dallo script.


### <a name="quick-fixes"></a>Correzioni rapide
Ecco l'elenco di elementi che possono essere corretti facilmente.
  1. Modificare il valore restituito dei metodi impostandolo su void se non restituisce il valore a JavaScript.
  2. Usare `.` per accedere all'attributo o per richiamare la funzione membro in Napi::Object invece di `->`.
  3. Sostituire `Napi::New(env, value);` con 'Napi::[Type]::New(env, value);


### <a name="major-reconstructions"></a>Ricostruzioni importanti
L'implementazione di `Napi::ObjectWrap` è significativamente diversa da quella di NAN. `Napi::ObjectWrap` accetta un puntatore all'oggetto di cui è stato eseguito il wrapping e crea un riferimento all'oggetto di cui è stato eseguito il wrapping all'interno del costruttore ObjectWrap. `Napi::ObjectWrap` associa anche i metodi di istanza dell'oggetto di cui è stato eseguito il wrapping al modulo JavaScript anziché a metodi statici come NAN.

Pertanto, se si usa Nan::ObjectWrap nel modulo, sarà necessario eseguire i passaggi seguenti.

  1. Convertire la funzione [ClassName]::New in una funzione costruttore che accetta `Napi::CallbackInfo`. Dichiararla come
```
[ClassName](const Napi::CallbackInfo& info);
```
e definirla come
```
[ClassName]::[ClassName](const Napi::CallbackInfo& info) : Napi::ObjectWrap<[ClassName]>(info){
  ...
}
```
In questo modo, il costruttore `Napi::ObjectWrap` verrà richiamato dopo la creazione di un'istanza dell'oggetto e `Napi::ObjectWrap` può usare il puntatore `this` per creare un riferimento all'oggetto di cui è stato eseguito il wrapping.

  2. Spostare il codice del costruttore originale nel nuovo costruttore. Eliminare il costruttore originale.
  3. Nella funzione di inizializzazione della classe associare i metodi nativi nel modo seguente.
```
Napi::FunctionReference constructor;

void [ClassName]::Init(Napi::Env env, Napi::Object exports, Napi::Object module) {
  Napi::HandleScope scope(env);
  Napi::Function ctor = DefineClass(env, "Canvas", {
    InstanceMethod<&[ClassName]::Func1>("Func1"),
    InstanceMethod<&[ClassName]::Func2>("Func2"),
    InstanceAccessor<&[ClassName]::ValueGetter>("Value"),
    StaticMethod<&[ClassName]::StaticMethod>("MethodName"),
    InstanceValue("Value", Napi::[Type]::New(env, value)),
  });

  constructor = Napi::Persistent(ctor);
  constructor .SuppressDestruct();
  exports.Set("[ClassName]", ctor);
}
```
  4. Nella funzione in cui è necessario annullare il wrapping di ObjectWrap in NAN, ad esempio `[ClassName]* native = Nan::ObjectWrap::Unwrap<[ClassName]>(info.This());`, usare il puntatore `this` direttamente come oggetto non sottoposto a wrapping, perché ogni istanza di ObjectWrap è associata a un'istanza di oggetto univoca.


Se si riscontrano ancora problemi dopo aver seguito questa guida, registrare un problema con una descrizione dettagliata e proveremo a risolverlo.
