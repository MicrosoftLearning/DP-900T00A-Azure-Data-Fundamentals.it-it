---
ms.openlocfilehash: 21db9b7ec97b7028a031a18867aab00575b09850
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053098"
---
# <a name="delayed-stream"></a>delayed-stream

Memorizza in un buffer gli eventi da un flusso finché non si è pronti per gestirli.

## <a name="installation"></a>Installazione

``` bash
npm install delayed-stream
```

## <a name="usage"></a>Utilizzo

Nell'esempio seguente viene illustrato come scrivere un server echo HTTP che ritarda la risposta per 1000 ms.

``` javascript
var DelayedStream = require('delayed-stream');
var http = require('http');

http.createServer(function(req, res) {
  var delayed = DelayedStream.create(req);

  setTimeout(function() {
    res.writeHead(200);
    delayed.pipe(res);
  }, 1000);
});
```

Se non si usa `Stream#pipe`, è anche possibile rilasciare manualmente gli eventi memorizzati nel buffer chiamando `delayedStream.resume()`:

``` javascript
var delayed = DelayedStream.create(req);

setTimeout(function() {
  // Emit all buffered events and resume underlaying source
  delayed.resume();
}, 1000);
```

## <a name="implementation"></a>Implementazione

Per usare correttamente questo flusso meta, ecco alcuni elementi che è necessario conoscere sull'implementazione.

### <a name="event-buffering--proxying"></a>Buffering di eventi/proxy

Viene assunto il controllo di tutti gli eventi del flusso `source` sovrascrivendo il metodo `source.emit`. Fino a quando Node non implementerà un listener di eventi catch-all, questo è l'unico modo.

Tuttavia, delayed-stream continua a generare tutti gli eventi acquisiti in `source`, indipendentemente dal fatto che sia stato rilasciato o meno il flusso ritardato.

Al momento della creazione, delayed-stream acquisisce tutti gli eventi `source` e li memorizza in un buffer di eventi interno. Una volta chiamato `delayedStream.release()`, tutti gli eventi memorizzati nel buffer vengono generati in `delayedStream` e il buffer di eventi viene cancellato. Successivamente, delayed-stream opera semplicemente come proxy per l'origine sottostante.

### <a name="error-handling"></a>Gestione degli errori

Gli eventi di errore in `source` sono memorizzati nel buffer/inviati tramite proxy esattamente come tutti gli altri eventi.
Tuttavia, `delayedStream.create` collega un listener `'error'` no-op all'oggetto `source`. In questo modo è necessario gestire solo gli errori nell'oggetto `delayedStream`, anziché in due posizioni.

### <a name="buffer-limits"></a>Limiti del buffer

delayed-stream fornisce una proprietà `maxDataSize` che può essere usata per limitare la quantità di dati memorizzati nel buffer. Per proteggere gli utenti dai flussi `source` non validi che non reagiscono a `source.pause()`, questa funzionalità è abilitata per impostazione predefinita.

## <a name="api"></a>API

### <a name="delayedstreamcreatesource-options"></a>DelayedStream.create(source, [options])

Restituisce un nuovo oggetto `delayedStream`. Le opzioni disponibili sono:

* `pauseStream`
* `maxDataSize`

Di seguito è riportata la descrizione per queste proprietà.

### <a name="delayedstreamsource"></a>delayedStream.source

Flusso `source` gestito da questo oggetto. È utile se si passa `delayedStream` e si vuole comunque accedere alle proprietà nell'oggetto `source`.

### <a name="delayedstreampausestream--true"></a>delayedStream.pauseStream = true

Indica se sospendere l'oggetto `source` sottostante quando viene chiamato `DelayedStream.create()`. La modifica di questa proprietà in seguito non ha alcun effetto.

### <a name="delayedstreammaxdatasize--1024--1024"></a>delayedStream.maxDataSize = 1024 * 1024

Quantità di dati da memorizzare nel buffer prima di generare `error`.

Se l'origine sottostante genera oggetti `Buffer`, `maxDataSize` si riferisce ai byte.

Se l'origine sottostante genera stringhe JavaScript, la dimensione si riferisce ai caratteri.

Se si è consapevoli delle conseguenze, è possibile impostare questa proprietà su `Infinity` per disabilitare la funzionalità. È anche possibile modificare questa proprietà in fase di runtime.

### <a name="delayedstreamdatasize--0"></a>delayedStream.dataSize = 0

La quantità di dati memorizzata nel buffer finora.

### <a name="delayedstreamreadable"></a>delayedStream.readable

Getter ECMA5 che restituisce il valore di `source.readable`.

### <a name="delayedstreamresume"></a>delayedStream.resume()

Se `delayedStream` non è stato rilasciato finora, viene chiamato `delayedStream.release()`.

In entrambi i casi, viene chiamato `source.resume()`.

### <a name="delayedstreampause"></a>delayedStream.pause()

Chiama `source.pause()`.

### <a name="delayedstreampipedest"></a>delayedStream.pipe(dest)

Chiama `delayedStream.resume()` e quindi invia tramite proxy gli argomenti a `source.pipe`.

### <a name="delayedstreamrelease"></a>delayedStream.release()

Genera e cancella tutti gli eventi che sono stati memorizzati nel buffer finora. Questa operazione non riprende l'origine sottostante. Usare invece `delayedStream.resume()`.

## <a name="license"></a>Licenza

delayed-stream è concesso in licenza secondo i termini della licenza MIT.
