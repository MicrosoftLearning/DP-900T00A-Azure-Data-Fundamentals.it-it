---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051539"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>Libreria client di Azure Cosmos DB per JavaScript/TypeScript

[![badge npm più recente](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![Stato compilazione](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

Azure Cosmos DB è un servizio di database multimodello distribuito a livello globale che supporta database di documenti, con coppie chiave-valore, con colonne ampie e grafi. Questo pacchetto è destinato alle applicazioni JavaScript/TypeScript che devono interagire con i database **API SQL** e i documenti JSON in essi contenuti:

- Creare database di Cosmos DB e modificarne le impostazioni
- Creare e modificare contenitori per archiviare le raccolte di documenti JSON
- Creare, leggere, aggiornare ed eliminare gli elementi (documenti JSON) nei contenitori
- Eseguire una query dei documenti nel database usando una sintassi di tipo SQL

Collegamenti principali:

- [Pacchetto (npm)][npm]
- [Documentazione di riferimento delle API](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [Documentazione del prodotto][cosmos_docs]

## <a name="getting-started"></a>Introduzione

### <a name="prerequisites"></a>Prerequisiti

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>Sottoscrizione di Azure e account API SQL di Cosmos DB

Per usare questo pacchetto, è necessario avere una [sottoscrizione di Azure][azure_sub] e un [account di Cosmos DB][cosmos_account] (API SQL).

Se è necessario un account API SQL di Cosmos DB, è possibile usare Azure [Cloud Shell][cloud_shell_bash] per crearne uno con questo comando dell'interfaccia della riga di comando di Azure:

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

In alternativa, è possibile creare un account nel [portale di Azure](https://portal.azure.com/#create/microsoft.documentdb)

#### <a name="nodejs"></a>NodeJS

Questo pacchetto viene distribuito tramite [npm][npm], preinstallato con [NodeJS](https://nodejs.org/en/). È consigliabile usare Node 10 o versione successiva.

#### <a name="cors"></a>CORS

Per lo sviluppo per i browser, è necessario configurare regole [CORS (Cross-Origin Resource Sharing)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) per l'account di Cosmos DB. Seguire le istruzioni nel documento collegato per creare nuove regole CORS per Cosmos DB.

### <a name="install-this-package"></a>Installare questo pacchetto

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>Ottenere le credenziali dell'account

Saranno necessari l'**endpoint** e la **chiave dell'account** di Cosmos DB. È possibile trovarli nel [portale di Azure](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts) o usare il frammento dell'[interfaccia della riga di comando di Azure][azure_cli] qui sotto. Il frammento è presentato nel formato per la shell Bash.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>Crea un'istanza di `CosmosClient`

L'interazione con Cosmos DB inizia con un'istanza della classe [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

Per semplicità gli elementi `key` ed `endpoint` sono stati inclusi direttamente nel codice, ma è possibile caricarli da un file non presente nel controllo del codice sorgente usando un progetto come [dotenv](https://www.npmjs.com/package/dotenv) o caricandoli dalle variabili di ambiente

Negli ambienti di produzione i segreti come le chiavi devono essere archiviati in [Azure Key Vault](https://azure.microsoft.com/services/key-vault/)

## <a name="key-concepts"></a>Concetti chiave

Dopo aver inizializzato [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates), è possibile interagire con i tipi di risorse primari in Cosmos DB:

- [Database](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest): Un account di Cosmos DB può contenere più database. Quando si crea un database, si specifica l'API che si vuole usare quando si interagisce con questi documenti: SQL, MongoDB, Gremlin, Cassandra o Tabella di Azure. Usare l'oggetto [Database](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) per gestirne i contenitori.

- [Contenitore](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest): Un contenitore è una raccolta di documenti JSON. Per creare (inserire), leggere, aggiornare ed eliminare elementi in un contenitore, è possibile usando i metodi sull'oggetto [Container](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest).

- [Articolo](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest): Un elemento è un documento JSON archiviato in un contenitore. Ogni elemento deve includere una chiave `id` con un valore che identifica in modo univoco l'elemento all'interno del contenitore. Se non si specifica un `id`, l'SDK ne genererà uno automaticamente.

Per altre informazioni su queste risorse, vedere [Usare database, contenitori ed elementi di Azure Cosmos][cosmos_resources].

## <a name="examples"></a>Esempio

Le sezioni seguenti contengono diversi frammenti di codice relativi ad alcune delle attività più comuni di Cosmos DB:

- [Creare un database](#create-a-database)
- [Creare un contenitore](#create-a-container)
- [Inserire elementi](#insert-items)
- [Eseguire query su documenti](#query-the-database)
- [Leggere un elemento](#read-an-item)
- [Eliminare un elemento](#delete-an-data)

### <a name="create-a-database"></a>Creazione di un database

Dopo aver autenticato [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest), è possibile usare qualsiasi risorsa nell'account. Il frammento di codice seguente crea un database API SQL.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>Creare un contenitore

Questo esempio crea un contenitore con impostazioni predefinite

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>Inserire elementi

Per inserire elementi in un contenitore, passare un oggetto contenente i dati a [Items.upsert](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-). Il servizio Cosmos DB richiede che ogni elemento abbia una chiave `id`. Se non se ne specifica una, l'SDK genererà automaticamente un `id`.

Questo esempio inserisce diversi elementi nel contenitore

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>Leggere un elemento

Per leggere un singolo elemento da un contenitore, usare [Item.read](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-). Si tratta di un'operazione meno costosa che usare SQL per eseguire una query in base a `id`.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>Eliminare un elemento

Per eliminare elementi da un contenitore, usare [Item.delete](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-).

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>Eseguire query sul database

Un database di API SQL Cosmos DB supporta l'esecuzione di query sugli elementi in un contenitore con [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) usando una sintassi simile a SQL:

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Eseguire query con parametri passando un oggetto contenente i parametri e i relativi valori a [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-):

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Per altre informazioni sull'esecuzione di query su database Cosmos DB tramite l'API SQL, vedere [Eseguire query SQL sui dati di Azure Cosmos DB][cosmos_sql_queries].

## <a name="troubleshooting"></a>Risoluzione dei problemi

### <a name="general"></a>Generale

Quando si interagisce con Cosmos DB, gli errori restituiti dal servizio corrispondono agli stessi codici di stato HTTP restituiti per le richieste API REST:

[Codici di stato HTTP per Azure Cosmos DB][cosmos_http_status_codes]

#### <a name="conflicts"></a>Conflitti

Se ad esempio si prova a creare un elemento usando un `id` già in uso nel database Cosmos DB, viene restituito un errore `409` che indica il conflitto. Nel frammento di codice seguente, l'errore viene gestito normalmente rilevando l'eccezione e visualizzando informazioni aggiuntive sull'errore.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>Transpile

Gli SDK di Azure sono progettati per supportare la sintassi ES5 JavaScript e le [versioni LTS di Node.js](https://nodejs.org/about/releases/). Se è necessario supporto per i runtime di JavaScript precedenti, ad esempio Internet Explorer o Node 6, sarà necessario eseguire il transpile del codice dell'SDK durante il processo di compilazione.

### <a name="handle-transient-errors-with-retries"></a>Gestire gli errori temporanei con nuovi tentativi

Mentre si usa Cosmos DB, potrebbero verificarsi errori temporanei causati dai [limiti di frequenza][cosmos_request_units] applicati dal servizio o altri problemi temporanei come interruzioni della rete. Per informazioni sulla gestione di questi tipi di errori, vedere [Modello di ripetizione dei tentativi][azure_pattern_retry] nella guida Modelli di progettazione cloud e l'articolo correlato [Modello a interruttore][azure_pattern_circuit_breaker].

## <a name="next-steps"></a>Passaggi successivi

### <a name="more-sample-code"></a>Altro codice di esempio

[Diversi esempi][cosmos_samples] sono disponibili nel repository GitHub dell'SDK. Questi esempi offrono codice di esempio per altri scenari comuni correlati all'uso di Cosmos DB:

- Operazioni sui database
- Operazioni sui contenitori
- Operazioni sugli elementi
- Configurazione dell'indicizzazione
- Lettura del feed di modifiche di un contenitore
- Stored procedure
- Modifica delle impostazioni di velocità effettiva di un database/contenitore
- Operazioni di scrittura in più aree

### <a name="additional-documentation"></a>Documentazione aggiuntiva

Per una documentazione più completa sul servizio Cosmos DB, vedere la [documentazione di Azure Cosmos DB][cosmos_docs] su docs.microsoft.com.

## <a name="useful-links"></a>Collegamenti utili

- [Introduzione ad Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/community)
- [Avvio rapido](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [Esercitazione](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [Esempi](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [Introduzione al modello di risorsa del servizio Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [Introduzione all'API SQL del servizio Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [Partizionamento](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [Documentazione delle API](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>Contributo

Per contribuire a questa libreria, leggere la [guida ai contributi](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) per altre informazioni su come compilare e testare il codice.

![Impression](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
